# 更新日志

## v1.2.0 - 2025-11-10

### 🔒 重大安全更新

#### 多层防绕过保护系统
- **Activity生命周期保护**
  - onPause/onStop/onDestroy 自动恢复机制
  - 窗口焦点丢失时立即重启锁屏
  - 防止用户通过任务管理器关闭应用

- **系统按键拦截**
  - 完全禁用返回键、Home键、菜单键
  - 拦截任务切换键和搜索键
  - 防止用户通过系统按键绕过

- **后台监控服务**
  - 每秒检查锁屏状态
  - 自动检测和恢复被绕过的锁屏
  - 进程状态实时监控

#### 设备管理员增强
- **可选设备管理员权限**
  - 系统级锁定能力
  - 增强应用持久性
  - 防止恶意卸载和禁用

- **权限管理优化**
  - 智能权限请求流程
  - 用户友好的权限说明
  - 可跳过高级权限设置

#### 窗口和任务栈保护
- **增强窗口标志**
  - 全屏覆盖系统UI
  - 强制显示在锁屏上方
  - 布局不受系统限制

- **任务栈隔离**
  - 独立任务栈运行
  - 排除在最近任务外
  - 防止任务切换绕过

### 🛡️ 安全特性

#### 防护等级
- **第一层**: UI层防护（按键拦截、全屏显示）
- **第二层**: Activity层防护（生命周期监控）
- **第三层**: Service层防护（后台监控恢复）
- **第四层**: 系统层防护（设备管理员权限）

#### 已知防护能力
✅ 返回键绕过 - 完全拦截  
✅ Home键绕过 - 立即恢复  
✅ 任务切换 - 自动恢复  
✅ 下拉通知栏 - 快速恢复  
✅ 任务管理器关闭 - 服务重启  
✅ 应用切换 - 实时监控  

#### 限制说明
⚠️ Root权限可能绕过  
⚠️ ADB调试可能绕过  
⚠️ 强制重启可以绕过  
⚠️ 安全模式可能绕过  

### 📝 技术实现

#### 新增文件
- `DeviceAdminReceiver.kt` - 设备管理员接收器
- `DeviceAdminManager.kt` - 设备管理员功能管理
- `SECURITY_FEATURES.md` - 详细安全文档

#### 核心改进
- 完全重写 `LockScreenActivity` 防护逻辑
- 增强 `LockScreenService` 监控能力
- 优化权限请求流程
- 新增多项安全配置

---

## v1.1.1 - 2025-11-10

### 🔧 默认设置优化

#### 数学题难度调整
- **数字范围**: 默认从20以内调整为50以内
- **题目数量**: 默认从3道题调整为6道题
- **运算类型**: 保持加减法（可在设置中修改）

#### 用户体验改进
- 提高默认难度，增加解锁挑战性
- 更多题目数量，增强安全性
- 用户仍可在控制台中自定义所有参数

---

## v1.1.0 - 2025-11-10

### 🔧 功能改进

#### 家长模式优化
- **新增30分钟有效期限制**
  - 家长模式激活后有效期为30分钟
  - 超过30分钟后自动失效，需重新验证PIN码
  - 自动启动30分钟倒计时，到期后重新锁屏

#### 安全性增强
- **隐藏控制台密码显示**
  - 移除了设置对话框中的密码提示
  - 密码不再明文显示，提高安全性
  - 用户需要记住控制台密码才能进入设置

### 📝 技术实现

#### 代码更新
- `LockScreenPreferences.kt`: 
  - 新增家长模式激活时间记录
  - 自动检查30分钟有效期
  - 过期自动重置家长模式状态

- `LockScreenService.kt`:
  - 家长模式也启动定时器（30分钟）
  - 统一的自动锁定逻辑

- `strings.xml`:
  - 更新密码提示文本
  - 移除明文密码显示

#### 用户体验改进
- 家长模式更加安全，避免长时间开放
- 密码保护更严格，提高隐私安全
- 保持原有功能的同时增强安全性

### 🎯 使用说明

#### 家长模式新规则
1. **激活**: 点击锁屏右上角按钮，输入正确PIN码
2. **有效期**: 激活后30分钟内有效
3. **过期**: 30分钟后自动锁屏，需重新验证
4. **重新激活**: 过期后需重新输入PIN码

#### 控制台访问
- 密码提示已隐藏，需要记住密码
- 增强了设置界面的安全性
- 密码仍为原设定值，但不再显示

### ⚠️ 注意事项
- 家长模式不再是"永久解锁"，有30分钟时间限制
- 控制台密码不再提示，请妥善保管
- 所有其他功能保持不变

---

## v1.0.0 - 2025-11-10

### 🎉 初始版本

#### 核心功能
- 数学题解锁系统
- 控制台设置界面
- 家长模式PIN码验证
- 自动锁屏服务
- 开机自启动

#### 技术特性
- Kotlin开发
- Android 7.0+支持
- Material Design界面
- 后台服务监听
- 完整项目结构